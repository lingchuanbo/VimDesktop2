# VimDesktop 扩展功能使用说明

## 功能概述
在托盘菜单中新增了"扩展功能"子菜单，可以方便地启动各种AutoHotkey脚本。

## 配置方法

### 1. 在配置文件中添加扩展功能
编辑 `Custom/vimd.ini` 文件，在 `[extensions]` 节中添加扩展功能：

```ini
[extensions]
; 扩展功能配置，格式：显示名称=文件路径|自动启动(1=是,0=否)
; 支持.ahk和.exe文件，程序会自动识别文件类型并选择合适的执行方式
窗口高亮 = \Apps\WindowHighlight\WindowHighlight.ahk|1
脚本管理 = \Apps\AHK2Manage\AHK2Manager.ahk|0
窗口跳转 = \Apps\QuickSwitch\QuickSwitchv1.1.ahk|1
窗口监视 = \Apps\WindowsSpy\WindowsSpy.ahk|0
PNG动画播放器 = \Apps\PngAniPlayer\PngAniPlayer.exe|0
```

### 2. 配置格式说明
- **显示名称**：在托盘菜单中显示的名称
- **脚本路径**：相对于VimDesktop根目录的文件路径
- **自动启动**：1=跟随主程序启动，0=仅手动启动
- **支持格式**：.ahk文件和.exe文件
- 路径以反斜杠 `\` 开头，表示相对于程序根目录
- 格式：`显示名称 = 文件路径|自动启动标志`

### 3. 使用方法
1. 右键点击托盘图标
2. 选择"扩展功能"子菜单
3. 点击要执行的扩展功能
4. 系统会自动使用 `\Apps\AutoHotkey.exe` 执行对应的脚本

## 执行原理

### 自动启动
程序启动时会：
1. 读取所有扩展功能配置
2. 检查自动启动标志（|1）
3. 自动执行设置为自动启动的扩展功能

### 手动执行
当点击扩展功能菜单项时，程序会：
1. 从配置文件读取对应的文件路径
2. 解析配置格式（文件路径|自动启动标志）
3. 根据文件扩展名选择执行方式：
   - .ahk文件：`AutoHotkey.exe "脚本完整路径"`
   - .exe文件：直接运行 `"程序完整路径"`
4. 检查文件是否存在
5. 如果存在则执行，否则显示错误提示

## 错误处理
- 如果脚本文件不存在，会显示错误提示
- 如果执行过程中出现异常，会显示详细的错误信息
- 如果没有配置任何扩展功能，子菜单会显示"暂无扩展功能"

## 注意事项
1. 脚本路径必须是相对于VimDesktop根目录的路径
2. 确保脚本文件确实存在于指定位置
3. 修改配置后需要重启VimDesktop才能生效（Win+Y）
4. 支持中英文界面切换

## 示例配置
```ini
[extensions]
; 窗口管理类（常用功能设为自动启动）
窗口高亮 = \Apps\WindowHighlight\WindowHighlight.ahk|1
窗口监视 = \Apps\WindowsSpy\WindowsSpy.ahk|0

; 工具管理类
脚本管理 = \Apps\AHK2Manage\AHK2Manager.ahk|0
窗口跳转 = \Apps\QuickSwitch\QuickSwitchv1.1.ahk|1

; 可执行程序类
PNG动画播放器 = \Apps\PngAniPlayer\PngAniPlayer.exe|0
记事本 = \Windows\System32\notepad.exe|0

; 系统增强类
TC窗口扩大 = \Apps\TC自动扩大本侧窗口\TC自动扩大本侧窗口Kawvin.ahk|0
```

## 菜单显示说明
- 设置为自动启动的扩展功能在菜单中会显示 ● 标识
- 例如：`窗口高亮 ●` 表示该功能会自动启动