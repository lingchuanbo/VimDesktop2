# VimDesktop 插件配置独立化说明

## 概述

为了提高插件的独立性和可维护性，VimDesktop现在支持将插件配置从主配置文件中分离出来，每个插件可以拥有自己独立的配置文件。

## 工作原理

### 配置分工
- **主配置文件** (`Custom/vimd.ini`): 管理插件的启用状态和默认模式
  - `[plugins]`: 控制插件是否启用
  - `[plugins_DefaultMode]`: 设置插件的默认模式
- **插件独立配置**: 仅包含插件特有的路径和参数配置

### 自动扫描机制
程序启动时会自动扫描`plugins`目录下的所有子目录，寻找同名的配置文件：

1. **插件目录名.ini** (如：`Everything\Everything.ini`)
2. **插件目录名小写.ini** (如：`Everything\everything.ini`)
3. **config.ini** (通用配置文件名)
4. **plugin.ini** (通用插件配置文件名)

### 配置优先级
1. **插件独立配置** - 插件特有参数（如路径）
2. **主配置文件** - 插件启用状态和模式设置
3. **默认路径** - 最后的备选方案

## 已实现的插件

### Everything插件
- **配置文件**: `plugins\Everything\everything.ini`
- **配置内容**:
```ini
[Everything]
everything_path = D:\WorkFlow\tools\TotalCMD\Tools\Everything\Everything.exe
```

### TTOTAL_CMD插件
- **配置文件**: `plugins\TTOTAL_CMD\TTOTAL_CMD.ini`
- **配置内容**:
```ini
[TTOTAL_CMD]
tc_dir_path = D:\WorkFlow\tools\TotalCMD
tc_ini_path = D:\WorkFlow\tools\TotalCMD\WinCMD.ini
tc_path = D:\WorkFlow\tools\TotalCMD\TOTALCMD.EXE
```

## 优势

### 1. 插件独立性
- 每个插件拥有独立的配置文件
- 插件可以单独分发和管理
- 配置修改不影响其他插件

### 2. 向后兼容
- 如果没有独立配置文件，自动从主配置文件读取
- 现有配置无需修改即可继续工作
- 平滑过渡到新的配置系统

### 3. 灵活性
- 支持多种配置文件命名方式
- 自动发现新插件的配置文件
- 无需手动注册插件配置

### 4. 可维护性
- 配置文件结构清晰
- 便于插件开发者维护
- 减少主配置文件的复杂度

## 使用方法

### 创建插件配置文件
1. 在对应插件目录下创建配置文件
2. 使用插件名作为文件名（推荐）
3. 按照原有格式编写配置内容

### 迁移现有配置
1. 从主配置文件复制相关配置节
2. 创建插件独立配置文件
3. 粘贴配置内容
4. 从主配置文件删除已迁移的配置（可选）

## 调试功能

在主配置文件中设置`enable_debug = 1`可以看到插件配置加载的详细信息：
- 成功加载的插件配置
- 加载失败的错误信息
- 配置文件路径信息

## 注意事项

1. **配置文件格式**：保持与原有格式一致
2. **路径设置**：使用绝对路径确保准确性
3. **编码格式**：建议使用UTF-8编码
4. **备份配置**：修改前建议备份原有配置

## 示例：添加新插件配置

假设要为新插件`MyPlugin`创建配置：

1. **在主配置文件中添加插件控制**：
```ini
[plugins]
MyPlugin = 1

[plugins_DefaultMode]
MyPlugin = VIM模式
```

2. **创建插件独立配置**：
   - 创建目录：`plugins\MyPlugin\`
   - 创建配置文件：`plugins\MyPlugin\MyPlugin.ini`
   - 编写配置内容：
```ini
[MyPlugin]
plugin_path = D:\MyTools\MyPlugin.exe
custom_setting = value
```

程序会自动发现并加载这个配置文件，插件代码中可以通过`PluginConfigs.MyPlugin.MyPlugin.plugin_path`访问配置。